<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Over There: A Trench Warfare Survival Sim</title>
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/font-awesome.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Courier+Prime:wght@400;700&display=swap');

        :root {
            --mud-dark: #3d3522;
            --khaki: #8b7d5b;
            --blood: #8b0000;
        }

        body {
            background-color: #0c0a09;
            color: #e4e4e7;
            font-family: 'Courier Prime', monospace;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        .typewriter { font-family: 'Special Elite', cursive; }

        .health-bar-fill {
            transition: width 0.5s ease-in-out, background-color 0.5s;
        }

        .map-container {
            position: relative;
            background: #d2b48c;
            border: 8px solid #3d3522;
            border-radius: 4px;
            color: #3d3522;
        }

        .hotspot {
            position: absolute;
            width: 24px;
            height: 24px;
            background: rgba(139, 0, 0, 0.7);
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.9; }
            70% { transform: scale(1.6); opacity: 0; }
            100% { transform: scale(1); opacity: 0; }
        }

        .modal {
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
        }

        .card-sepia {
            background: #f4ecd8;
            color: #2c2416;
            box-shadow: 6px 6px 0px #3d3522;
            border: 1px solid #c9bda4;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #71717a; }

        #game-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="bg-zinc-950">

    <div id="game-container" class="w-full p-4">
        
        <!-- Splash Screen -->
        <div id="splash" class="text-center max-w-2xl py-12 mx-auto">
            <h1 class="text-6xl md:text-8xl typewriter text-yellow-700 mb-2 uppercase tracking-tighter filter drop-shadow-lg">Over There</h1>
            <p class="text-xl mb-10 italic text-zinc-500 uppercase tracking-widest">A Western Front Simulation</p>
            <div class="bg-zinc-900/80 p-10 rounded-xl border-2 border-yellow-900/30 mb-10 shadow-2xl backdrop-blur-sm">
                <p class="text-xl mb-6 leading-relaxed">France, 1918. You are a doughboy in the AEF. The air is iron, the ground is liquid, and the whistles are screaming.</p>
                <p class="text-zinc-400">Can you survive 10 rounds on the line?</p>
            </div>
            <button onclick="startGame()" class="bg-yellow-800 hover:bg-yellow-700 text-white font-bold py-6 px-16 rounded-sm text-2xl transition-all transform hover:scale-105 active:scale-95 uppercase shadow-[0_0_20px_rgba(133,77,14,0.3)] border-b-4 border-yellow-950">
                Enlist for Duty
            </button>
        </div>

        <!-- Role Selection -->
        <div id="role-selection" class="hidden text-center max-w-5xl w-full mx-auto">
            <h2 class="text-4xl typewriter mb-12 text-yellow-700">Service Assignment</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 px-4">
                <div onclick="selectRole('Infantry')" class="card-sepia p-10 cursor-pointer hover:-translate-y-2 transition-transform">
                    <i class="fa-solid fa-person-rifle text-6xl mb-6 text-yellow-950"></i>
                    <h3 class="font-bold text-2xl mb-4 uppercase tracking-tighter">Infantry</h3>
                    <p class="text-sm leading-relaxed opacity-80">Rugged frontline combatant. Start with 12 Health. Built for the push.</p>
                </div>
                <div onclick="selectRole('Medic')" class="card-sepia p-10 cursor-pointer hover:-translate-y-2 transition-transform">
                    <i class="fa-solid fa-briefcase-medical text-6xl mb-6 text-red-900"></i>
                    <h3 class="font-bold text-2xl mb-4 uppercase tracking-tighter">Medic</h3>
                    <p class="text-sm leading-relaxed opacity-80">Battlefield healer. Regain +1 extra Health on non-combat rounds.</p>
                </div>
                <div onclick="selectRole('Hellfighter')" class="card-sepia p-10 cursor-pointer hover:-translate-y-2 transition-transform">
                    <i class="fa-solid fa-shield-halved text-6xl mb-6 text-blue-900"></i>
                    <h3 class="font-bold text-2xl mb-4 uppercase tracking-tighter">Hellfighter</h3>
                    <p class="text-sm leading-relaxed opacity-80">Elite 369th soldier. High morale and better odds in night operations.</p>
                </div>
            </div>
        </div>

        <!-- Main Interface -->
        <div id="game-ui" class="hidden w-full max-w-6xl flex flex-col gap-6 mx-auto">
            <!-- HUD -->
            <div class="flex flex-col md:flex-row justify-between items-center bg-zinc-900 p-6 border-b-4 border-yellow-900/50 rounded-t-xl shadow-xl">
                <div class="flex items-center gap-10 mb-6 md:mb-0">
                    <div class="text-center">
                        <span class="text-[10px] uppercase text-zinc-500 tracking-[0.2em] block mb-1">Current Sector</span>
                        <div id="round-number" class="text-4xl font-bold typewriter text-white">01</div>
                    </div>
                    <div class="h-10 w-px bg-zinc-800"></div>
                    <div>
                        <span class="text-[10px] uppercase text-zinc-500 tracking-[0.2em] block mb-2">Vitality Status</span>
                        <div class="w-64 h-4 bg-zinc-950 rounded-full overflow-hidden p-0.5 border border-zinc-800">
                            <div id="health-bar" class="health-bar-fill h-full bg-green-700 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="toggleMap()" class="bg-zinc-800 px-6 py-3 rounded text-xs font-bold hover:bg-zinc-700 transition border border-zinc-700 uppercase tracking-widest">
                        <i class="fa-solid fa-map mr-2"></i> Intelligence
                    </button>
                    <button onclick="toggleManual()" class="bg-zinc-800 px-6 py-3 rounded text-xs font-bold hover:bg-zinc-700 transition border border-zinc-700 uppercase tracking-widest">
                        <i class="fa-solid fa-file-invoice mr-2"></i> Orders
                    </button>
                </div>
            </div>

            <!-- Main Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Left Narrative -->
                <div class="lg:col-span-8 flex flex-col gap-6">
                    <div id="image-area" class="w-full aspect-[21/9] bg-zinc-900 rounded-xl overflow-hidden border border-zinc-800 relative shadow-2xl group">
                        <img id="round-image" src="" alt="War" class="w-full h-full object-cover opacity-40 grayscale group-hover:grayscale-0 transition-all duration-1000">
                        <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 via-zinc-950/20 to-transparent"></div>
                        <div id="round-title" class="absolute bottom-8 left-8 text-4xl typewriter text-white font-bold tracking-tight uppercase">Loading...</div>
                    </div>
                    
                    <div class="bg-zinc-900/50 p-10 rounded-xl border border-zinc-800/50 shadow-inner">
                        <p id="round-text" class="text-xl leading-relaxed mb-10 text-zinc-300 font-light"></p>
                        <div id="options-container" class="flex flex-col gap-4">
                            <!-- Decisions -->
                        </div>
                    </div>
                </div>

                <!-- Right Action Log -->
                <div class="lg:col-span-4 flex flex-col gap-6">
                    <div class="bg-zinc-900 p-8 rounded-xl border border-zinc-800 flex flex-col h-full min-h-[400px]">
                        <h3 class="text-yellow-700 uppercase text-[10px] font-black mb-8 flex items-center gap-3 tracking-[0.3em]">
                            <i class="fa-solid fa-stamp"></i> Battalion Journal
                        </h3>
                        <div id="fate-content" class="text-lg text-zinc-500 italic leading-relaxed space-y-4">
                            Waiting for field intelligence...
                        </div>
                        
                        <!-- Luck/Dice Mechanic -->
                        <div id="dice-roll-ui" class="hidden mt-auto pt-10 border-t border-zinc-800">
                            <p class="text-[10px] uppercase text-zinc-500 mb-6 text-center tracking-widest font-bold">Rolling D12 for Survival</p>
                            <div class="flex items-center justify-center mb-8">
                                <div id="dice-value" class="w-24 h-24 bg-zinc-950 border-2 border-yellow-900/30 flex items-center justify-center text-5xl typewriter text-white shadow-[0_0_30px_rgba(0,0,0,1)]">?</div>
                            </div>
                            <button id="roll-btn" class="w-full bg-red-950 hover:bg-red-900 text-white font-bold py-5 rounded transition-all shadow-xl uppercase tracking-[0.2em] border-b-4 border-black">
                                Roll for Fate
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODALS -->
        <div id="map-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-6">
            <div class="map-container w-full max-w-4xl p-8">
                <div class="flex justify-between items-center mb-6 border-b border-yellow-950/20 pb-4">
                    <h2 class="text-3xl typewriter font-bold text-yellow-950 uppercase tracking-tighter">Tactical Theater</h2>
                    <button onclick="toggleMap()" class="text-yellow-950 text-4xl">&times;</button>
                </div>
                <div class="relative w-full aspect-video bg-[#f1e4cc] border border-black overflow-hidden shadow-inner">
                    <svg viewBox="0 0 800 450" class="w-full h-full opacity-80">
                        <path d="M200,0 C250,150 180,300 230,450" stroke="#8b0000" stroke-width="4" stroke-dasharray="8,4" fill="none" />
                        <text x="40" y="220" font-family="monospace" font-size="20" fill="#3d3522">AEF LINE</text>
                        <text x="500" y="220" font-family="monospace" font-size="20" fill="#3d3522">CENTRAL POWERS</text>
                    </svg>
                    <div class="hotspot" style="top: 20%; left: 26%;" onclick="showInfo('The Somme', 'Devastated by years of conflict.')"></div>
                    <div class="hotspot" style="top: 50%; left: 24%;" onclick="showInfo('Belleau Wood', 'U.S. Marines pushing through heavy timber.')"></div>
                    <div class="hotspot" style="top: 80%; left: 28%;" onclick="showInfo('Meuse-Argonne', 'The final bloody offensive.')"></div>
                </div>
                <div id="map-info" class="mt-6 p-5 bg-yellow-900/10 rounded border border-yellow-900/20 text-yellow-950 italic text-center">
                    Select a reconnaissance point.
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden text-center max-w-3xl py-12 mx-auto">
            <h1 id="end-title" class="text-7xl typewriter mb-8 text-white uppercase tracking-tighter">M.I.A.</h1>
            <p id="end-description" class="text-2xl mb-12 leading-relaxed text-zinc-400 font-light italic"></p>
            <div id="stats-summary" class="bg-zinc-900 p-10 rounded-xl mb-12 border border-zinc-800 shadow-2xl"></div>
            <button onclick="location.reload()" class="bg-yellow-800 hover:bg-yellow-700 text-white px-16 py-6 rounded-sm text-xl font-bold uppercase tracking-widest transition shadow-2xl border-b-4 border-yellow-950">
                Return to the Front
            </button>
        </div>
    </div>

    <script>
        let gameState = {
            round: 0,
            health: 10,
            maxHealth: 10,
            role: '',
            history: []
        };

        const ROUNDS = [
            {
                title: "Sector 1: The Railhead",
                text: "You arrive at the railhead near Verdun. The sky is a bruised purple and the air tastes of cordite. Your Sergeant is barking orders to unload heavy crates of artillery shells.",
                image: "https://images.unsplash.com/photo-1590402449133-79ed6523e055?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Help unload shells (Labor)", health: -1, outcome: "Your muscles scream, but the supply officer gives you extra chocolate.", fate: "Physical toll (-1 HP), Morale up." },
                    { text: "Orient yourself with the maps", health: 0, outcome: "You memorize the fallback lines and bunker locations.", fate: "No physical change, but focus is high." },
                    { text: "Try to steal a nap in the mud", health: +1, outcome: "You catch 20 minutes of rest despite the shelling.", fate: "Recuperated (+1 HP)." }
                ]
            },
            {
                title: "Sector 2: Night Watch",
                text: "Your first night in the frontline trench. A flare goes up, bathing No Man's Land in a haunting white light. You hear a wire-cutter clicking just 20 yards away.",
                image: "https://images.unsplash.com/photo-1547115865-c806e395213d?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Fire your Springfield at the sound", health: 0, outcome: "You hit a stray dog. Your nerves are shot, and now the enemy knows your spot.", fate: "Exposed and rattled." },
                    { text: "Toss a grenade into the dark", health: -1, outcome: "A German raiding party was indeed there. They retreat, but a piece of debris hits your shoulder.", fate: "Wounded (-1 HP)." },
                    { text: "Alert your officer quietly", health: 0, outcome: "The machine gunners prep. The raiders see the movement and vanish.", fate: "Professional conduct." }
                ]
            },
            {
                title: "Sector 3: The Hunger",
                text: "The supply lines are bogged down in the mud. You've been eating hardtack and muddy water for three days. You are starving.",
                image: "https://images.unsplash.com/photo-1563294132-84950882e38c?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Scavenge from a fallen soldier", health: 0, outcome: "You find a tin of bully beef. It's grim, but you eat.", fate: "Survival instinct." },
                    { text: "Drink from the shell crater", health: -3, outcome: "The water was contaminated with gas residue. You are violently ill.", fate: "Severe illness (-3 HP)." },
                    { text: "Share your last bit of bread", health: +1, outcome: "A comrade gives you a pair of dry socks in return.", fate: "Altruism (+1 HP)." }
                ],
                challenge: { type: "dice", difficulty: 10, success: "Found hidden rations! (+2 HP)", fail: "Starvation deepens (-1 HP)" }
            },
            {
                title: "Sector 4: Yellow Fog",
                text: "A low, greenish cloud begins to drift into the trench. The warning bell ringsâ€”a sharp, frantic metal-on-metal clang. 'GAS! GAS!'",
                image: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Don your mask immediately", health: 0, outcome: "The seal is tight. You sit in silence for an hour, breathing rubbery air.", fate: "Safety first." },
                    { text: "Help the rookie next to you", health: -2, outcome: "He survives, but you take a lungful of chlorine before your mask is on.", fate: "Heroic sacrifice (-2 HP)." },
                    { text: "Try to outrun the cloud", health: -5, outcome: "You can't outrun the wind. The gas sears your throat.", fate: "Fatal error (-5 HP)." }
                ]
            },
            {
                title: "Sector 5: Over the Top",
                text: "The whistle blows. A shrill, piercing sound that haunts your dreams. You climb the ladder and sprint into the chaos of lead and mud.",
                image: "https://images.unsplash.com/photo-1533228834458-95853b925577?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Charge the MG nest", health: -4, outcome: "You knock it out with a grenade, but catch two bullets in the thigh.", fate: "Major wound (-4 HP)." },
                    { text: "Dive into a shell crater", health: -1, outcome: "You survive the initial volley, pinned down by fire.", fate: "Pinned (-1 HP)." },
                    { text: "Provide covering fire", health: -2, outcome: "You stay upright to shoot, making yourself a target.", fate: "Suppression role (-2 HP)." }
                ]
            },
            {
                title: "Sector 6: Trench Foot",
                text: "It has rained for 72 hours. Your boots are full of water. Your feet have turned a ghostly white and have lost all feeling.",
                image: "https://images.unsplash.com/photo-1505672678657-cc7037095e60?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Rub whale oil on your feet", health: +1, outcome: "It's greasy and smells, but it saves your toes.", fate: "Hygiene (+1 HP)." },
                    { text: "Ignore it and keep your boots on", health: -2, outcome: "The rot sets in. You can barely walk.", fate: "Medical neglect (-2 HP)." },
                    { text: "Swap socks with a dead man", health: 0, outcome: "A dark necessity. Your feet are dry for now.", fate: "Desperation." }
                ]
            },
            {
                title: "Sector 7: The Sniper",
                text: "A German sniper in a ruined farmhouse is picking off the runners. Your platoon leader asks for a volunteer to crawl out and locate him.",
                image: "https://images.unsplash.com/photo-1501705388883-4ed8a543392c?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Volunteer (Scout)", health: -1, outcome: "You find him, but a bullet grazes your helmet.", fate: "Risk taken (-1 HP)." },
                    { text: "Stay back and use a periscope", health: 0, outcome: "You spot the flash safely. The artillery takes care of the rest.", fate: "Calculated play." },
                    { text: "Try to bait the sniper", health: -2, outcome: "You raise your hat on a stick. He doesn't fall for it; he shoots through the trench wall instead.", fate: "Outsmarted (-2 HP)." }
                ]
            },
            {
                title: "Sector 8: The Fever",
                text: "The Spanish Influenza is tearing through the camps. You wake up with a 104-degree fever and a cough that brings up blood.",
                image: "https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Report to the Casualty Clearing Station", health: -2, outcome: "Crowded and miserable, but you get some rest.", fate: "Hospitalized (-2 HP)." },
                    { text: "Stay on the line", health: -4, outcome: "You collapse in the mud. The pneumonia is brutal.", fate: "Critically ill (-4 HP)." },
                    { text: "Drink extra rum and water", health: -1, outcome: "You push through, but you're a ghost of yourself.", fate: "Stubborn (-1 HP)." }
                ]
            },
            {
                title: "Sector 9: The Final Advance",
                text: "The Hindenburg Line is broken! We are chasing the enemy through a burning forest. It's hand-to-hand combat in the thicket.",
                image: "https://images.unsplash.com/photo-1526333313259-ff8736465451?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Lead the bayonet charge", health: -3, outcome: "You take the trench, but you're cut up in the melee.", fate: "Glory at a cost (-3 HP)." },
                    { text: "Clear out a concrete bunker", health: -1, outcome: "A grenade blast rings your ears permanently.", fate: "Tinnitus (-1 HP)." },
                    { text: "Flank through the wire", health: -2, outcome: "The barbs tear at your legs, but you get behind them.", fate: "Lacerations (-2 HP)." }
                ]
            },
            {
                title: "Sector 10: 10:59 AM",
                text: "The word has come down. The Armistice is signed. At 11:00 AM, the war ends. One minute left. An enemy MG is still firing blindly.",
                image: "https://images.unsplash.com/photo-1533228100845-08145b01de2c?auto=format&fit=crop&q=80&w=1200",
                options: [
                    { text: "Stay low in the dugout", health: 0, outcome: "Silence falls. The birds begin to sing for the first time in years.", fate: "Survivor." },
                    { text: "Fire one last shot for luck", health: -1, outcome: "The muzzle flash draws fire. You're hit in the arm at 11:00 exactly.", fate: "Tragedy (-1 HP)." },
                    { text: "Check on your squad", health: 0, outcome: "You find your best friend is still alive. You weep together.", fate: "Humanity." }
                ]
            }
        ];

        function startGame() {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('role-selection').classList.remove('hidden');
        }

        function selectRole(role) {
            gameState.role = role;
            gameState.health = (role === 'Infantry') ? 12 : 10;
            gameState.maxHealth = gameState.health;
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            renderRound();
        }

        function renderRound() {
            const round = ROUNDS[gameState.round];
            const roundNumElem = document.getElementById('round-number');
            const titleElem = document.getElementById('round-title');
            const textElem = document.getElementById('round-text');
            const imageElem = document.getElementById('round-image');

            if(roundNumElem) roundNumElem.innerText = (gameState.round + 1).toString().padStart(2, '0');
            if(titleElem) titleElem.innerText = round.title;
            if(textElem) textElem.innerText = round.text;
            if(imageElem) imageElem.src = round.image;

            const container = document.getElementById('options-container');
            if(container) {
                container.innerHTML = '';
                round.options.forEach((opt, i) => {
                    const btn = document.createElement('button');
                    btn.className = "bg-zinc-800 hover:bg-yellow-900/40 text-left p-6 rounded border-l-4 border-zinc-700 hover:border-yellow-700 transition-all text-sm uppercase tracking-wider font-bold shadow-lg";
                    btn.innerHTML = `<span class="text-yellow-700 mr-4">${i+1}.</span> ${opt.text}`;
                    btn.onclick = () => makeDecision(opt);
                    container.appendChild(btn);
                });
            }

            updateHUD();
        }

        function makeDecision(opt) {
            gameState.health += opt.health;
            if (gameState.role === 'Medic' && opt.health >= 0) {
                gameState.health = Math.min(gameState.health + 1, gameState.maxHealth);
            }
            
            const fatePanel = document.getElementById('fate-content');
            if(fatePanel) {
                fatePanel.innerHTML = `
                    <div class="text-white font-bold text-xl uppercase tracking-tighter mb-2">${opt.outcome}</div>
                    <div class="text-xs text-yellow-700 font-bold uppercase mb-4 tracking-[0.2em]">${opt.fate}</div>
                    <div class="text-xs ${opt.health < 0 ? 'text-red-500' : 'text-green-500'} font-bold">
                        [EFFECT: ${opt.health > 0 ? '+' : ''}${opt.health} VITALITY]
                    </div>
                `;
            }

            if (gameState.health <= 0) {
                endGame("Killed in Action");
                return;
            }

            const round = ROUNDS[gameState.round];
            if (round.challenge) {
                triggerChallenge(round.challenge);
            } else {
                showNextBtn();
            }
            updateHUD();
        }

        function triggerChallenge(c) {
            const ui = document.getElementById('dice-roll-ui');
            const btn = document.getElementById('roll-btn');
            if(ui) ui.classList.remove('hidden');
            if(btn) {
                btn.onclick = () => {
                    const roll = Math.floor(Math.random() * 12) + 1;
                    const diceValElem = document.getElementById('dice-value');
                    if(diceValElem) diceValElem.innerText = roll;
                    btn.disabled = true;
                    setTimeout(() => {
                        const fateContent = document.getElementById('fate-content');
                        if (roll >= c.difficulty) {
                            gameState.health += 2;
                            if(fateContent) fateContent.innerHTML += `<div class="mt-4 text-green-500 uppercase text-xs font-black">LUCK PREVAILS: ${c.success}</div>`;
                        } else {
                            gameState.health -= 1;
                            if(fateContent) fateContent.innerHTML += `<div class="mt-4 text-red-500 uppercase text-xs font-black">FATE CRUEL: ${c.fail}</div>`;
                        }
                        if(ui) ui.classList.add('hidden');
                        btn.disabled = false;
                        if(diceValElem) diceValElem.innerText = "?";
                        updateHUD();
                        if (gameState.health <= 0) endGame("Fell in Battle");
                        else showNextBtn();
                    }, 1000);
                };
            }
        }

        function showNextBtn() {
            const container = document.getElementById('options-container');
            if(container) {
                container.innerHTML = '';
                const btn = document.createElement('button');
                btn.className = "bg-yellow-800 hover:bg-yellow-700 text-white font-bold py-6 rounded uppercase tracking-widest transition shadow-2xl mt-4 border-b-4 border-yellow-950 w-full";
                btn.innerText = gameState.round === 9 ? "Reach the Armistice" : "Advance to Next Sector";
                btn.onclick = () => {
                    gameState.round++;
                    if (gameState.round >= ROUNDS.length) determineFinalEnd();
                    else renderRound();
                };
                container.appendChild(btn);
            }
        }

        function updateHUD() {
            const pct = (gameState.health / gameState.maxHealth) * 100;
            const bar = document.getElementById('health-bar');
            if(bar) {
                bar.style.width = `${Math.max(0, pct)}%`;
                if (pct > 60) bar.style.backgroundColor = "#15803d";
                else if (pct > 30) bar.style.backgroundColor = "#a16207";
                else bar.style.backgroundColor = "#991b1b";
            }
        }

        function determineFinalEnd() {
            let title = "", desc = "";
            if (gameState.health >= 8) {
                title = "Distinguished Service";
                desc = "You returned home a hero, though the sound of the guns never truly left you. You spent your life advocating for your fellow veterans.";
            } else if (gameState.health >= 4) {
                title = "Honorable Survivor";
                desc = "You survived. You returned to your farm or factory, living a quiet life, forever marked by the mud of France.";
            } else {
                title = "The Lost Generation";
                desc = "The war took almost everything from you. You made it home, but the physical and mental scars made the peace feel like a different kind of battle.";
            }
            endGame(title, desc);
        }

        function endGame(title, desc) {
            const ui = document.getElementById('game-ui');
            const end = document.getElementById('end-screen');
            if(ui) ui.classList.add('hidden');
            if(end) {
                end.classList.remove('hidden');
                document.getElementById('end-title').innerText = title;
                document.getElementById('end-description').innerText = desc || "Your journey ends in the soil of the Western Front. You are gone, but not forgotten.";
                document.getElementById('stats-summary').innerHTML = `
                    <div class="grid grid-cols-2 gap-8 text-left">
                        <div><span class="text-[10px] text-zinc-500 uppercase tracking-widest block">Unit</span><p class="text-xl font-bold">${gameState.role}</p></div>
                        <div><span class="text-[10px] text-zinc-500 uppercase tracking-widest block">Sectors Cleared</span><p class="text-xl font-bold">${gameState.round + 1}</p></div>
                    </div>
                `;
            }
        }

        function toggleMap() { 
            const modal = document.getElementById('map-modal');
            if(modal) modal.classList.toggle('hidden'); 
        }
        
        function toggleManual() { 
            const msg = document.createElement('div');
            msg.className = "fixed inset-0 z-[100] flex items-center justify-center bg-black/80 p-4";
            msg.innerHTML = `
                <div class="bg-zinc-900 border border-yellow-900/50 p-8 max-w-md w-full rounded shadow-2xl">
                    <h4 class="text-yellow-700 font-bold mb-4 uppercase tracking-widest">General Orders</h4>
                    <p class="text-zinc-400 mb-6">1. Hold the line at all costs.<br>2. Watch for gas at all hours.<br>3. Keep your rifle clean and your spirits high.</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full bg-yellow-800 py-3 font-bold uppercase text-xs">Acknowledge</button>
                </div>
            `;
            document.body.appendChild(msg);
        }
        
        function showInfo(t, i) { 
            const info = document.getElementById('map-info');
            if(info) info.innerHTML = `<strong>${t}:</strong> ${i}`; 
        }

        // Standard entry point for games
        window.onload = function() {
            console.log("War Simulation Initialized...");
            // Hide everything except splash on load
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
        };
    </script>
</body>
</html>